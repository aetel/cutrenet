{% extends "layout.html" %}
{% from "security/_macros.html" import render_field_with_errors, render_field, render_field_label_with_errors_spectre, render_field_label_social_with_errors_spectre %}

{% block content %}
{% include "messages.html" %}
{% if 'edit' in request.url %}
  <div class="card">
      <h5 class="card-header">Editando a {{result["first_name"]}} {{result["last_name"]}} </h5>
  <div class="card-body">
    <form action="{{ url_for('edit_member') }}" method="POST" name="form" class="form-horizontal">
      {{ form.hidden_tag() }}
      <input type="hidden" name="old_dni" value='{{result["dni"]}}' />
      {{ render_field_label_with_errors_spectre(form.first_name, class_="form-input", value=result["first_name"]) }}
      {{ render_field_label_with_errors_spectre(form.last_name, class_="form-input", value=result["last_name"]) }}
      {{ render_field_label_social_with_errors_spectre(form.telegram, class_="form-input", value=result["telegram"]) }}
      <div class="form-group">
        <div class="col-3 col-sm-12"></div>
        <div class="col-9 col-sm-12">
          <p class="form-input-hint">No es obligatorio, pero es necesario para usar <a href="http://t.me/aetelbot">@aetelbot</a>.</p>
        </div>
      </div>
      {{ render_field_label_with_errors_spectre(form.year, class_="form-select", value=result["year"]) }}
      {{ render_field_label_with_errors_spectre(form.school, onchange="planes()", class_="form-select", value=result["school"]) }}
      {{ render_field_label_with_errors_spectre(form.degree, class_="form-select", value=result["degree"]) }}
      {{ render_field_label_with_errors_spectre(form.dni, class_="form-input", value=result["dni"]) }}
      {{ render_field_label_with_errors_spectre(form.email, class_="form-input", value=result["email"]) }}
      {{ render_field(form.submit, class_="btn btn-primary btn-large btn-block", value="Guardar") }}
    </form>
  </div>
</div>
{% else %}
  <div class="card">
    <h5 class="card-header">Perfil de {{result["first_name"]}} {{result["last_name"]}} <a href="{{ url_for('select_edit_member_profile', edni=result['dni']) }}" class="profile-edit"><i class="icon icon-edit"></i> Edit</a></h5>
    <div class="card-body">
        <p>Nombre: {{result["first_name"]}}</p>
        <p>Apellidos: {{result["last_name"]}}</p>
        <p>DNI o NIE: {{result["dni"]}}</p>
        <p>Escuela: {{result["school"]}}</p>
        <p>Grado: {{result["degree"]}}</p>
        <p>Curso actual: {{result["year"]}}</p>
        <p>Email: {{result["email"]}}</p>
        <p>Nick de Telegram: {{result["telegram"]}}</p>
        <p>Miembro de AETEL: {% if result['active'] == 0 %}
              <i class="icon icon-cross text-error"></i>
            {% else %}
              <i class="icon icon-check text-success"></i>
            {% endif %}
          </p>
        No estás contento?
        <a class="btn btn-error delete" href="{{ url_for('delete_profile', dni=result['dni']) }}" data-confirm="¿Estás seguro de querer borrar tu perfil?">Borrar perfil</a>
    </div>
  </div>
  <script type="text/javascript">
    var deleteLinks = document.querySelectorAll('.delete');

    for (var i = 0; i < deleteLinks.length; i++) {
      deleteLinks[i].addEventListener('click', function(event) {
        event.preventDefault();

        var choice = confirm(this.getAttribute('data-confirm'));

        if (choice) {
          window.location.href = this.getAttribute('href');
        }
      });
    }
  </script>
{% endif %}
{% include "footer.html" %}
{% endblock %}
